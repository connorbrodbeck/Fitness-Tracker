<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker - Road to 180 lbs</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Auth Overlay -->
    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-container">
            <h1>Fitness Tracker</h1>
            <p class="auth-subtitle">Road to your goals</p>

            <div id="auth-tabs" class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
            </div>

            <div id="auth-error" class="auth-error" style="display:none;"></div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form" onsubmit="handleLogin(event)">
                <input type="text" id="login-username" placeholder="Username" required autocomplete="username">
                <input type="password" id="login-password" placeholder="Password" required autocomplete="current-password">
                <button type="submit">Login</button>
            </form>

            <!-- Signup Form -->
            <form id="signup-form" class="auth-form" style="display:none;" onsubmit="handleSignup(event)">
                <input type="text" id="signup-username" placeholder="Username" required autocomplete="username">
                <input type="password" id="signup-password" placeholder="Password (min 6 chars)" required minlength="6" autocomplete="new-password">
                <label for="signup-weight" class="auth-label">Your Weight (lbs)</label>
                <input type="number" id="signup-weight" step="0.1" value="145" required>
                <label for="signup-goal" class="auth-label">Weight Goal (lbs)</label>
                <input type="number" id="signup-goal" step="0.1" value="180" required>
                <button type="submit">Create Account</button>
            </form>
        </div>
    </div>

    <div class="container" id="app-container" style="display:none;">
        <!-- Header -->
        <header>
            <div class="header-top">
                <a id="admin-link" href="admin.html" style="display:none; position: absolute; left: 0; color: #667eea; font-weight: 600; text-decoration: none; padding: 6px 16px; border: 2px solid #667eea; border-radius: 20px; font-size: 0.9em; transition: all 0.3s;">Admin</a>
                <h1>Fitness Tracker</h1>
                <button id="logout-btn" class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
            <p class="tagline" id="tagline">Road to <span id="goal-weight-display">180</span> lbs | Current: <span id="current-weight">145</span> lbs</p>
            <div class="date-display" id="current-date"></div>
            <button id="install-btn" class="install-btn" style="display:none;">Install App</button>
        </header>

        <!-- Motivation Quote Banner -->
        <div class="quote-banner" id="quote-banner"></div>

        <!-- Quick Stats Dashboard -->
        <section class="stats-grid">
            <div class="stat-card water">
                <h3>Water Today</h3>
                <div class="stat-value" id="water-status">Not Yet</div>
                <button onclick="toggleWater()">Mark Complete</button>
            </div>

            <div class="stat-card calories">
                <h3>Calories Today</h3>
                <div class="stat-value" id="calorie-count">0</div>
                <p class="goal-text">Goal: <span id="calorie-goal">3000</span> cal</p>
            </div>

            <div class="stat-card gym">
                <h3>Gym Session</h3>
                <div class="stat-value" id="gym-status">Not Logged</div>
                <button onclick="showGymModal()">Log Workout</button>
            </div>

            <div class="stat-card running">
                <h3>Running</h3>
                <div class="stat-value" id="run-distance">0 mi</div>
                <button onclick="showRunModal()">Log Run</button>
            </div>
        </section>

        <!-- Streak Counter -->
        <section class="streak-section">
            <h2>Current Streak</h2>
            <div class="streak-display">
                <div class="streak-number" id="streak-count">0</div>
                <div class="streak-label">days in a row</div>
            </div>
            <p class="streak-best">Best streak: <span id="best-streak">0</span> days</p>
        </section>

        <!-- Weekly Progress Chart -->
        <section class="chart-section">
            <h2>This Week's Progress</h2>
            <div class="week-calendar" id="week-calendar"></div>
        </section>

        <!-- Monthly Calendar -->
        <section class="monthly-section">
            <div class="monthly-header">
                <button onclick="prevMonth()" class="month-nav-btn">&larr;</button>
                <h2 id="monthly-title">Monthly Overview</h2>
                <button onclick="nextMonth()" class="month-nav-btn">&rarr;</button>
            </div>
            <div class="monthly-day-labels">
                <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
            </div>
            <div class="monthly-calendar" id="monthly-calendar"></div>
        </section>

        <!-- Weight Progress -->
        <section class="weight-section">
            <h2 id="weight-journey-title">Weight Journey: 145 &rarr; 180 lbs</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="weight-progress"></div>
            </div>
            <p class="progress-text">
                <span id="weight-gained">0</span> lbs gained |
                <span id="weight-remaining">35</span> lbs to go
            </p>
            <div class="weight-chart" id="weight-chart"></div>
            <button onclick="showWeightModal()">Log Weekly Weight</button>
        </section>

        <!-- Progress Photos -->
        <section class="photos-section">
            <h2>Progress Photos</h2>
            <div class="photos-gallery" id="photos-gallery">
                <p style="color:#999; padding:10px;">No progress photos yet.</p>
            </div>
            <button onclick="showModal('photo-upload-modal')" class="photo-upload-btn">Upload Progress Photo</button>
        </section>

        <!-- Photo Upload Modal -->
        <div id="photo-upload-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('photo-upload-modal')">&times;</span>
                <h2>Upload Progress Photo</h2>
                <input type="file" id="photo-file-input" accept="image/*" onchange="previewPhoto(this)">
                <img id="photo-preview" class="photo-preview" style="display:none;">
                <input type="date" id="photo-date-input">
                <input type="text" id="photo-notes" placeholder="Notes (optional)">
                <input type="number" id="photo-weight" placeholder="Weight at time (optional)" step="0.1">
                <button onclick="uploadProgressPhoto()">Save Photo</button>
            </div>
        </div>

        <!-- Photo View Modal -->
        <div id="photo-view-modal" class="modal">
            <div class="modal-content photo-view-content">
                <span class="close" onclick="closeModal('photo-view-modal')">&times;</span>
                <img id="photo-view-img" class="photo-view-img">
                <div id="photo-view-details" class="photo-view-details"></div>
                <button onclick="deleteViewedPhoto()" class="photo-delete-btn">Delete Photo</button>
            </div>
        </div>

        <!-- Data Entry Modals -->
        <div id="gym-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('gym-modal')">&times;</span>
                <h2>Log Gym Session</h2>
                <div class="exercise-library" id="exercise-library-container"></div>
                <textarea id="gym-exercises" placeholder="What exercises did you do?
Example:
- Bench Press: 185 lbs x 5
- Squats: 225 lbs x 8
- Pull-ups: 3 sets of 10"></textarea>
                <input type="text" id="gym-prs" placeholder="Any new PRs? (optional)">
                <button onclick="saveGymSession()">Save Workout</button>
            </div>
        </div>

        <div id="run-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('run-modal')">&times;</span>
                <h2>Log Run</h2>
                <input type="number" id="run-distance-input" placeholder="Distance (miles)" step="0.1">
                <input type="text" id="run-pace" placeholder="Pace (e.g., 8:30 per mile)">
                <input type="number" id="run-duration" placeholder="Duration (minutes)">
                <button onclick="saveRun()">Save Run</button>
            </div>
        </div>

        <div id="calorie-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('calorie-modal')">&times;</span>
                <h2>Log Meal</h2>
                <div class="presets-container" id="meal-presets-container"></div>
                <input type="text" id="meal-name" placeholder="What did you eat?">
                <input type="number" id="meal-calories" placeholder="Calories">
                <div class="modal-btn-row">
                    <button onclick="saveMeal()">Add Meal</button>
                    <button onclick="saveAsPreset()" class="preset-save-btn">Save as Preset</button>
                </div>
                <div id="meal-list" class="meal-list"></div>
            </div>
        </div>

        <div id="weight-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('weight-modal')">&times;</span>
                <h2>Log Weekly Weight</h2>
                <input type="number" id="weight-input" placeholder="Current weight (lbs)" step="0.1">
                <button onclick="saveWeight()">Save Weight</button>
            </div>
        </div>

        <!-- Today's Meals -->
        <section class="meals-section">
            <h2>Today's Meals</h2>
            <div id="today-meals"></div>
        </section>

        <!-- History Section -->
        <section class="history-section">
            <h2>Recent Activity</h2>
            <div id="activity-log"></div>
        </section>

        <!-- Quick Add Buttons -->
        <div class="quick-actions">
            <button onclick="showModal('calorie-modal')">+ Add Meal</button>
            <button onclick="exportData()">Export Data</button>
            <button onclick="resetDay()">Reset Today</button>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="app.js"></script>
    <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('SW registered:', reg.scope))
            .catch(err => console.log('SW registration failed:', err));
    }

    // Install prompt
    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');

    window.addEventListener('beforeinstallprompt', e => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'inline-block';
    });

    installBtn.addEventListener('click', () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(choice => {
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });
    });

    window.addEventListener('appinstalled', () => {
        installBtn.style.display = 'none';
    });
    </script>
</body>
</html>
